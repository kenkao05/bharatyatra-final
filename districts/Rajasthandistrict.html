<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rajasthan Districts | Bharat Yatra</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap');
    :root{--state-primary:#000;--state-secondary:#fff;--state-accent:#8B0000;--state-accent-dark:#660000;--text-muted:#666;--transition:all .3s ease}
    *{margin:0;padding:0;box-sizing:border-box;font-family:Georgia,'Times New Roman',serif}
    body{background:#fff;overflow-x:hidden;padding-top:80px}
    #navbar{position:fixed;top:0;width:100%;padding:20px 0;z-index:1000;background:#000;box-shadow:0 2px 10px rgba(0,0,0,.1);transition:var(--transition)}
    .nav-container{max-width:1400px;margin:0 auto;padding:0 40px;display:flex;justify-content:space-between;align-items:center}
    .logo{color:var(--state-accent);font-size:1.8rem;font-weight:bold;letter-spacing:3px;text-decoration:none}
    .nav-links{display:flex;gap:40px;align-items:center;list-style:none}
    .nav-links a{color:#fff;text-decoration:none;font-size:1rem;font-weight:500;transition:var(--transition);position:relative}
    .nav-links a::after{content:'';position:absolute;bottom:-5px;left:0;width:0;height:2px;background:var(--state-accent);transition:width .3s ease}
    .nav-links a:hover,.nav-links a:hover::after{color:var(--state-accent);width:100%}
    .menu-btn{color:#fff;font-size:1.5rem;cursor:pointer}
    .sidebar{position:fixed;right:-320px;top:0;width:300px;height:100%;background:var(--state-primary);z-index:2000;transition:var(--transition);padding:30px;overflow-y:auto}
    .sidebar.active{right:0}
    .close-btn{color:var(--state-secondary);font-size:2rem;cursor:pointer;text-align:right;margin-bottom:20px}
    .sidebar-links{list-style:none}
    .sidebar-links li{padding:12px 0;border-bottom:1px solid #333}
    .sidebar-links a{color:var(--state-secondary);text-decoration:none;display:flex;align-items:center;gap:15px;transition:.3s}
    .sidebar-links a:hover{color:var(--state-accent);padding-left:10px}
    .overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);visibility:hidden;opacity:0;z-index:1500;transition:var(--transition)}
    .overlay.active{visibility:visible;opacity:1}
    .page-header{background:linear-gradient(135deg,#000 0%,#1a1a1a 100%);padding:60px 40px 40px;text-align:center;color:#fff}
    .page-header h1{font-size:48px;font-weight:700;margin-bottom:15px;letter-spacing:2px}
    .page-header p{font-size:18px;color:#ccc}
    .search-filter-section{max-width:1400px;margin:40px auto;padding:0 40px}
    .search-filter-container{display:flex;gap:20px;flex-wrap:wrap;align-items:center;background:#f5f5f5;padding:25px;border-radius:0;border:2px solid var(--state-accent)}
    .search-box{flex:1;min-width:250px;position:relative}
    .search-box input{width:100%;padding:12px 40px 12px 15px;border:2px solid #ddd;border-radius:0;font-size:16px;transition:var(--transition)}
    .search-box input:focus{outline:0;border-color:var(--state-accent)}
    .search-box i{position:absolute;right:15px;top:50%;transform:translateY(-50%);color:var(--state-accent)}
    .filter-group{display:flex;gap:15px;align-items:center}
    .filter-select{padding:12px 15px;border:2px solid #ddd;border-radius:0;font-size:16px;background:#fff;cursor:pointer;transition:var(--transition)}
    .filter-select:focus{outline:0;border-color:var(--state-accent)}
    .toggle-btn{display:flex;align-items:center;gap:10px;padding:12px 20px;background:#fff;border:2px solid #ddd;cursor:pointer;transition:var(--transition);font-size:16px}
    .toggle-btn.active{background:var(--state-accent);color:#fff;border-color:var(--state-accent)}
    .toggle-btn input[type=checkbox]{display:none}
    .districts-section{max-width:1400px;margin:40px auto;padding:0 40px}
    .section-title{font-size:36px;font-weight:700;margin-bottom:30px;color:var(--state-primary);position:relative;display:inline-block}
    .section-title::after{content:"";position:absolute;bottom:-10px;left:0;width:80px;height:4px;background:var(--state-accent)}
    .districts-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:30px;margin-top:50px}
    .district-card{background:#fff;border:3px solid var(--state-accent);overflow:hidden;transition:transform .3s ease,box-shadow .3s ease;cursor:pointer}
    .district-card:hover{transform:translateY(-10px);box-shadow:0 15px 40px rgba(139,0,0,.3)}
    .district-card-image{width:100%;height:220px;object-fit:cover;filter:grayscale(.2);transition:var(--transition)}
    .district-card:hover .district-card-image{filter:grayscale(0)}
    .district-card-content{padding:20px}
    .district-card-content h3{font-size:24px;margin-bottom:10px;color:var(--state-primary)}
    .district-card-content .attraction-count{color:var(--text-muted);font-size:15px;margin-bottom:15px;display:flex;align-items:center;gap:8px}
    .district-card-content .attraction-count i{color:var(--state-accent)}
    .view-details-btn{display:inline-block;background:var(--state-accent);color:#fff;padding:10px 20px;border-radius:0;text-decoration:none;font-weight:600;font-size:14px;transition:var(--transition);border:2px solid var(--state-accent)}
    .view-details-btn:hover{background:var(--state-accent-dark);border-color:var(--state-accent-dark)}
    .map-section{max-width:1400px;margin:60px auto;padding:0 40px}
    .map-container{display:flex;gap:30px;border:3px solid var(--state-accent);background:#f5f5f5;padding:30px}
    .map-wrapper{flex:1.2;display:flex;align-items:center;justify-content:center;background:#fff;padding:20px}
    .map-wrapper svg{max-width:100%;height:auto}
    .district-list-wrapper{flex:1;overflow-y:auto;max-height:600px}
    .district-list{list-style:none}
    .district-list-item{padding:15px 20px;border-bottom:2px solid #ddd;cursor:pointer;transition:var(--transition);background:#fff;display:flex;justify-content:space-between;align-items:center}
    .district-list-item:hover,.district-list-item.active{background:var(--state-accent);color:#fff}
    .district-list-item .district-name{font-weight:600;font-size:16px}
    .district-list-item .district-count{font-size:14px;color:var(--text-muted)}
    .district-list-item:hover .district-count,.district-list-item.active .district-count{color:#fff}
    .map-wrapper svg path,.map-wrapper svg rect{fill:#ccc;stroke:#000;stroke-width:1;transition:fill .3s ease,transform .2s ease;cursor:pointer}
    .map-wrapper svg path.highlighted,.map-wrapper svg rect.highlighted{fill:var(--state-accent);stroke:#000;stroke-width:2}
    .map-wrapper svg path:hover,.map-wrapper svg rect:hover{fill:var(--state-accent-dark)}
    .map-wrapper svg text{pointer-events:none;font-size:11px;fill:#000}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:3000;align-items:center;justify-content:center;padding:20px;overflow-y:auto}
    .modal.active{display:flex}
    .modal-content{background:#fff;border-radius:0;max-width:900px;width:100%;max-height:90vh;overflow-y:auto;position:relative;animation:modalSlideIn .3s ease;border:4px solid var(--state-accent);margin:auto}
    @keyframes modalSlideIn{from{opacity:0;transform:translateY(-50px)}to{opacity:1;transform:translateY(0)}}
    .modal-close{position:absolute;top:20px;right:20px;width:40px;height:40px;border-radius:50%;background:var(--state-accent);color:#fff;border:none;font-size:20px;cursor:pointer;z-index:10;transition:var(--transition)}
    .modal-close:hover{background:var(--state-accent-dark);transform:rotate(90deg)}
    .modal-back{position:absolute;top:20px;left:20px;width:40px;height:40px;border-radius:50%;background:var(--state-primary);color:#fff;border:none;font-size:20px;cursor:pointer;z-index:10;transition:var(--transition);display:none}
    .modal-back.visible{display:block}
    .modal-back:hover{background:var(--state-accent);transform:translateX(-5px)}
    .modal-image{width:100%;height:350px;object-fit:cover;filter:grayscale(.2)}
    .modal-body{padding:40px}
    .modal-body h2{font-size:32px;margin-bottom:20px;color:var(--state-primary)}
    .modal-body p{color:var(--text-muted);line-height:1.8;margin-bottom:20px}
    .attractions-grid-modal{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px;margin-top:30px}
    .attraction-card-modal{background:#f5f5f5;border:2px solid var(--state-accent);padding:15px;cursor:pointer;transition:var(--transition)}
    .attraction-card-modal:hover{background:var(--state-accent);color:#fff;transform:translateY(-5px)}
    .attraction-card-modal h4{font-size:18px;margin-bottom:8px}
    .attraction-card-modal p{font-size:14px;margin:0}
    .attraction-card-modal:hover p{color:#fff}
    .accommodations-section{margin-top:30px;padding-top:30px;border-top:2px solid var(--state-accent)}
    .accommodations-section h3{font-size:24px;margin-bottom:20px;color:var(--state-primary)}
    .accommodation-list{list-style:none}
    .accommodation-item{padding:15px;background:#f5f5f5;border-left:4px solid var(--state-accent);margin-bottom:10px}
    .accommodation-item h4{font-size:18px;margin-bottom:5px;color:var(--state-primary)}
    .accommodation-item .acc-details{display:flex;gap:20px;flex-wrap:wrap;font-size:14px;color:var(--text-muted)}
    .accommodation-item .acc-details span{display:flex;align-items:center;gap:5px}
    .accommodation-item .acc-details i{color:var(--state-accent)}
    .no-data{text-align:center;padding:40px;color:var(--text-muted);font-style:italic}
    footer{background:var(--state-primary);color:var(--state-secondary);padding:60px 20px;border-top:4px solid #ff6b35;margin-top:80px}
    .footer-grid{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:30px}
    .footer-section h3{color:#ff6b35;margin-bottom:20px;font-size:1rem;text-transform:uppercase;border-left:3px solid #ff6b35;padding-left:10px}
    .footer-section ul{list-style:none}
    .footer-section a{color:#bbb;text-decoration:none;font-size:.95rem;line-height:2.2;transition:var(--transition)}
    .footer-section a:hover{color:#ff6b35;padding-left:5px}
    .footer-social{display:flex;gap:15px;margin-top:15px}
    .footer-social a{width:35px;height:35px;background:#333;display:flex;align-items:center;justify-content:center;border-radius:50%;color:#fff;transition:.3s}
    .footer-social a:hover{background:#ff6b35}
    .app-links{margin-top:20px;display:flex;flex-direction:column;gap:10px}
    .app-link{background:#000;color:#fff;padding:10px;border-radius:5px;display:flex;align-items:center;gap:10px;text-decoration:none;border:1px solid #333;font-size:.8rem}
    .app-link:hover{border-color:#ff6b35}
    .footer-bottom{text-align:center;margin-top:50px;padding-top:20px;border-top:1px solid #333;color:#777;font-size:.85rem}
    @media (max-width:1200px){.districts-grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:1024px){.nav-links{display:none}.districts-grid{grid-template-columns:repeat(2,1fr)}.map-container{flex-direction:column}}
    @media (max-width:768px){.districts-grid{grid-template-columns:1fr}.search-filter-container{flex-direction:column}.page-header h1{font-size:32px}.modal-body{padding:20px}.attractions-grid-modal{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <nav id="navbar">
    <div class="nav-container">
      <a href="#" class="logo">BHARAT YATRA</a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="rajasthan.html">Rajasthan</a></li>
        <li><a href="about.html">About Us</a></li>
      </ul>
      <div class="menu-btn" id="open-sidebar"><i class="fas fa-bars"></i></div>
    </div>
  </nav>
  <div class="sidebar" id="sidebar">
    <div class="close-btn" id="close-sidebar">×</div>
    <ul class="sidebar-links">
      <li><a href="#"><i class="fas fa-map-marker-alt"></i> Destination</a></li>
      <li><a href="#"><i class="fas fa-star"></i> Experiences</a></li>
      <li><a href="#"><i class="fas fa-calendar-check"></i> Plan Your Trip</a></li>
      <li><a href="#"><i class="fas fa-globe"></i> Content Hub</a></li>
      <li><a href="#"><i class="fas fa-heart"></i> Travel for Life</a></li>
      <li><a href="#"><i class="fas fa-palette"></i> Colours of India</a></li>
      <li><a href="#"><i class="fas fa-question-circle"></i> FAQ</a></li>
      <li><a href="#"><i class="fas fa-envelope"></i> Contact Us</a></li>
    </ul>
  </div>
  <div class="overlay" id="overlay"></div>
  <div class="page-header">
    <h1>Explore Rajasthan Districts</h1>
    <p>Discover the land of kings, majestic forts, and vibrant culture across Rajasthan's districts</p>
  </div>
  <div class="search-filter-section">
    <div class="search-filter-container">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search districts...">
        <i class="fas fa-search"></i>
      </div>
      <div class="filter-group">
        <select id="sortSelect" class="filter-select">
          <option value="attractions-desc">Most Attractions</option>
          <option value="attractions-asc">Least Attractions</option>
          <option value="name-asc">Name (A-Z)</option>
          <option value="name-desc">Name (Z-A)</option>
        </select>
        <label class="toggle-btn" id="accommodationsToggle">
          <input type="checkbox" id="accommodationsCheckbox">
          <i class="fas fa-hotel"></i>
          <span>With Accommodations</span>
        </label>
      </div>
    </div>
  </div>
  <div class="districts-section">
    <h2 class="section-title">All Districts</h2>
    <div class="districts-grid" id="districtsGrid"></div>
  </div>
  <div class="map-section">
    <h2 class="section-title">Interactive District Map</h2>
    <div class="map-container">
      <div class="map-wrapper" id="mapWrapper"></div>
      <div class="district-list-wrapper">
        <ul class="district-list" id="districtList"></ul>
      </div>
    </div>
  </div>
  <div class="modal" id="districtModal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeDistrictModal()">×</button>
      <button class="modal-back" id="modalBack" onclick="goBackToDistrict()"><i class="fas fa-arrow-left"></i></button>
      <div id="modalContentArea"></div>
    </div>
  </div>
  <footer>
    <div class="footer-grid">
      <div class="footer-section">
        <h3>Quick Links</h3>
        <ul>
          <li><a href="#">Home</a></li>
          <li><a href="#">About Us</a></li>
          <li><a href="#">Destinations</a></li>
          <li><a href="#">Contact Us</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Medical Tourism</h3>
        <ul>
          <li><a href="#">Medical Tourism</a></li>
          <li><a href="#">SEPC Medical Tourism</a></li>
          <li><a href="#">Wellness Centers</a></li>
          <li><a href="#">Yoga Retreats</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Special Hospitals</h3>
        <ul>
          <li><a href="#">AIIMS Delhi</a></li>
          <li><a href="#">Apollo Hospitals</a></li>
          <li><a href="#">Fortis Healthcare</a></li>
          <li><a href="#">Medanta Hospital</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Experiences</h3>
        <ul>
          <li><a href="#">Cultural Tours</a></li>
          <li><a href="#">Luxury Travel</a></li>
          <li><a href="#">Eco Tourism</a></li>
          <li><a href="#">Wildlife Safari</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Follow & App</h3>
        <div class="footer-social">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-youtube"></i></a>
        </div>
        <div class="app-links">
          <a href="#" class="app-link"><i class="fab fa-google-play"></i><div><small>Get it on</small><br>Google Play</div></a>
          <a href="#" class="app-link"><i class="fab fa-apple"></i><div><small>Download on</small><br>App Store</div></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>© 2026 Bharat Yatra - Incredible India. All Rights Reserved.</p>
    </div>
  </footer>
  <script>
    const supabaseClient=supabase.createClient("https://gtpnojbbamoaznlutxap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0cG5vamJiYW1vYXpubHV0eGFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4Mjk3NjMsImV4cCI6MjA4NDQwNTc2M30.t6fwQJR9ljGGfOajPlXzWGSQbKCtpaTb4dWfb33BHxE");
    let allDistricts=[],filteredDistricts=[],currentDistrict=null;
    const sidebar=document.getElementById('sidebar'),overlay=document.getElementById('overlay'),openBtn=document.getElementById('open-sidebar'),closeBtn=document.getElementById('close-sidebar');
    openBtn.addEventListener('click',()=>{sidebar.classList.add('active');overlay.classList.add('active');document.body.style.overflow='hidden'});
    const closeSidebar=()=>{sidebar.classList.remove('active');overlay.classList.remove('active');document.body.style.overflow='auto'};
    closeBtn.addEventListener('click',closeSidebar);overlay.addEventListener('click',closeSidebar);
    async function loadDistricts(){
      try{
        const{data,error}=await supabaseClient.from("districts").select(`id,name,image_url,description,attractions(id,name,short_description,image_url,entry_fee,estimated_time_hours,best_time_note,address,city,contact_phone,guide_available,guide_price_range,description,accommodations(id,name,type,price_per_night,distance_from_attraction_km,contact_phone,rating))`).eq("state_id",2);
        if(error)throw error;
        allDistricts=data.map(d=>({...d,attractionCount:d.attractions.length,hasAccommodations:d.attractions.some(a=>a.accommodations&&a.accommodations.length>0)}));
        filteredDistricts=[...allDistricts];
        sortDistricts('attractions-desc');
        renderDistricts();
        renderDistrictList();
        loadSVGMap();
      }catch(error){
        console.error("Error loading districts:",error);
        document.getElementById('districtsGrid').innerHTML='<div class="no-data">Failed to load districts. Please try again.</div>';
      }
    }
    function sortDistricts(sortType){
      switch(sortType){
        case 'attractions-desc':filteredDistricts.sort((a,b)=>b.attractionCount-a.attractionCount);break;
        case 'attractions-asc':filteredDistricts.sort((a,b)=>a.attractionCount-b.attractionCount);break;
        case 'name-asc':filteredDistricts.sort((a,b)=>a.name.localeCompare(b.name));break;
        case 'name-desc':filteredDistricts.sort((a,b)=>b.name.localeCompare(a.name));break;
      }
      renderDistricts();
    }
    function filterDistricts(){
      const searchTerm=document.getElementById('searchInput').value.toLowerCase();
      const showOnlyWithAccommodations=document.getElementById('accommodationsCheckbox').checked;
      filteredDistricts=allDistricts.filter(district=>{
        const matchesSearch=district.name.toLowerCase().includes(searchTerm);
        const matchesAccommodation=!showOnlyWithAccommodations||district.hasAccommodations;
        return matchesSearch&&matchesAccommodation;
      });
      const currentSort=document.getElementById('sortSelect').value;
      sortDistricts(currentSort);
    }
    function renderDistricts(){
      const container=document.getElementById('districtsGrid');
      if(filteredDistricts.length===0){container.innerHTML='<div class="no-data">No districts found matching your criteria.</div>';return}
      container.innerHTML='';
      filteredDistricts.forEach(district=>{
        const card=document.createElement('div');
        card.className='district-card';
        card.onclick=()=>openDistrictModal(district.id);
        card.innerHTML=`<img src="${district.image_url||'https://via.placeholder.com/400x220?text='+district.name}" alt="${district.name}" class="district-card-image"><div class="district-card-content"><h3>${district.name}</h3><div class="attraction-count"><i class="fas fa-map-marked-alt"></i><span>${district.attractionCount} attraction${district.attractionCount!==1?'s':''}</span></div><button class="view-details-btn">View Details</button></div>`;
        container.appendChild(card);
      });
    }
    function renderDistrictList(){
      const listContainer=document.getElementById('districtList');
      listContainer.innerHTML='';
      const sortedDistricts=[...allDistricts].sort((a,b)=>a.name.localeCompare(b.name));
      sortedDistricts.forEach(district=>{
        const li=document.createElement('li');
        li.className='district-list-item';
        li.dataset.districtName=district.name;
        li.innerHTML=`<div class="district-name">${district.name}</div><div class="district-count">${district.attractionCount} attractions</div>`;
        li.onclick=()=>selectDistrictOnMap(district.name);
        listContainer.appendChild(li);
      });
    }
    function loadSVGMap(){
      const svgContent=`<svg id="rajasthanMap" xmlns="http://www.w3.org/2000/svg" version="1.1" baseProfile="full" width="100%" height="auto" viewBox="0 0 800 600" style="background-color:#f0f0f0"><defs><filter id="shadow" x="-50%" y="-50%" width="200%" height="200%"><feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/></filter></defs><rect width="100%" height="100%" fill="#f0f0f0"/><rect class="district-path" data-district="Jaipur" x="350" y="250" width="100" height="80" fill="#ccc" stroke="#000" stroke-width="2"/><text x="400" y="295" text-anchor="middle" font-size="12" fill="#000">Jaipur</text><rect class="district-path" data-district="Udaipur" x="200" y="350" width="100" height="80" fill="#ccc" stroke="#000" stroke-width="2"/><text x="250" y="395" text-anchor="middle" font-size="12" fill="#000">Udaipur</text><rect class="district-path" data-district="Jodhpur" x="150" y="200" width="100" height="80" fill="#ccc" stroke="#000" stroke-width="2"/><text x="200" y="245" text-anchor="middle" font-size="12" fill="#000">Jodhpur</text><rect class="district-path" data-district="Jaisalmer" x="50" y="100" width="100" height="80" fill="#ccc" stroke="#000" stroke-width="2"/><text x="100" y="145" text-anchor="middle" font-size="12" fill="#000">Jaisalmer</text><rect class="district-path" data-district="Pushkar" x="300" y="200" width="80" height="60" fill="#ccc" stroke="#000" stroke-width="2"/><text x="340" y="235" text-anchor="middle" font-size="12" fill="#000">Pushkar</text><rect class="district-path" data-district="Ranthambore" x="500" y="280" width="90" height="70" fill="#ccc" stroke="#000" stroke-width="2"/><text x="545" y="320" text-anchor="middle" font-size="12" fill="#000">Ranthambore</text><rect class="district-path" data-district="Mount Abu" x="100" y="400" width="90" height="70" fill="#ccc" stroke="#000" stroke-width="2"/><text x="145" y="440" text-anchor="middle" font-size="12" fill="#000">Mount Abu</text><g id="accommodationMarkers"></g></svg>`;
      document.getElementById('mapWrapper').innerHTML=svgContent;
      const districtPaths=document.querySelectorAll('.district-path');
      districtPaths.forEach(path=>{path.addEventListener('click',()=>{const districtName=path.dataset.district;selectDistrictOnMap(districtName)})});
    }
    let selectedDistrict=null;
    function selectDistrictOnMap(districtName){
      const district=allDistricts.find(d=>d.name===districtName);
      if(!district){console.log('District not found:',districtName);return}
      selectedDistrict=district;
      highlightDistrict(districtName);
      renderAccommodationsList(district);
      showAccommodationMarkers(district);
    }
    function highlightDistrict(districtName){
      document.querySelectorAll('.district-path').forEach(path=>{path.classList.remove('highlighted')});
      document.querySelectorAll('.district-list-item').forEach(item=>{item.classList.remove('active')});
      const selectedPath=document.querySelector(`.district-path[data-district="${districtName}"]`);
      if(selectedPath){selectedPath.classList.add('highlighted')}
      const selectedListItem=document.querySelector(`.district-list-item[data-district-name="${districtName}"]`);
      if(selectedListItem){selectedListItem.classList.add('active');selectedListItem.scrollIntoView({behavior:'smooth',block:'nearest'})}
    }
    function renderAccommodationsList(district){
      const listContainer=document.getElementById('districtList');
      listContainer.innerHTML='';
      const header=document.createElement('div');
      header.style.cssText='padding:20px;background:var(--state-accent);color:white;font-weight:600;font-size:18px;position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center';
      header.innerHTML=`<span>${district.name} - Accommodations</span><button onclick="resetMapView()" style="background:white;color:var(--state-accent);border:none;padding:8px 15px;cursor:pointer;font-weight:600;border-radius:0"><i class="fas fa-times"></i> Close</button>`;
      listContainer.appendChild(header);
      const allAccommodations=[];
      district.attractions.forEach(attraction=>{if(attraction.accommodations&&attraction.accommodations.length>0){attraction.accommodations.forEach(acc=>{allAccommodations.push({...acc,attractionName:attraction.name})})}});
      if(allAccommodations.length===0){const noData=document.createElement('div');noData.className='no-data';noData.textContent='No accommodations found in this district.';listContainer.appendChild(noData);return}
      allAccommodations.forEach((acc,index)=>{
        const li=document.createElement('li');
        li.className='district-list-item';
        li.style.flexDirection='column';
        li.style.alignItems='flex-start';
        li.style.cursor='default';
        li.innerHTML=`<div style="display:flex;justify-content:space-between;width:100%;margin-bottom:8px"><strong style="font-size:16px;color:var(--state-primary)">${acc.name}</strong><span style="background:var(--state-accent);color:white;padding:2px 8px;font-size:12px;border-radius:3px">${acc.type.toUpperCase()}</span></div><div style="font-size:13px;color:var(--text-muted);margin-bottom:5px"><i class="fas fa-map-pin" style="color:var(--state-accent);margin-right:5px"></i>Near ${acc.attractionName}</div><div style="display:flex;gap:15px;flex-wrap:wrap;font-size:13px;color:var(--text-muted)"><span><i class="fas fa-rupee-sign" style="color:var(--state-accent)"></i> ₹${acc.price_per_night}/night</span>${acc.rating?`<span><i class="fas fa-star" style="color:var(--state-accent)"></i> ${acc.rating}/5</span>`:''} ${acc.distance_from_attraction_km?`<span><i class="fas fa-road" style="color:var(--state-accent)"></i> ${acc.distance_from_attraction_km} km</span>`:''}</div>`;
        listContainer.appendChild(li);
      });
    }
    function resetMapView(){
      selectedDistrict=null;
      renderDistrictList();
      document.querySelectorAll('.district-path').forEach(path=>{path.classList.remove('highlighted')});
      const markersGroup=document.getElementById('accommodationMarkers');
      if(markersGroup){markersGroup.innerHTML=''}
    }
    function showAccommodationMarkers(district){
      const markersGroup=document.getElementById('accommodationMarkers');
      if(!markersGroup)return;
      markersGroup.innerHTML='';
      const districtPath=document.querySelector(`.district-path[data-district="${district.name}"]`);
      if(!districtPath)return;
      const bbox=districtPath.getBBox();
      const allAccommodations=[];
      district.attractions.forEach(attraction=>{if(attraction.accommodations&&attraction.accommodations.length>0){attraction.accommodations.forEach(acc=>{allAccommodations.push({...acc,attractionName:attraction.name})})}});
      allAccommodations.forEach((acc,index)=>{
        const x=bbox.x+bbox.width*.2+(Math.random()*bbox.width*.6);
        const y=bbox.y+bbox.height*.2+(Math.random()*bbox.height*.6);
        const markerGroup=document.createElementNS('http://www.w3.org/2000/svg','g');
        markerGroup.setAttribute('transform',`translate(${x}, ${y})`);
        const circle=document.createElementNS('http://www.w3.org/2000/svg','circle');
        circle.setAttribute('r','6');
        circle.setAttribute('fill','#8B0000');
        circle.setAttribute('stroke','#ffffff');
        circle.setAttribute('stroke-width','2');
        circle.style.cursor='pointer';
        circle.style.filter='drop-shadow(0 2px 4px rgba(0,0,0,0.3))';
        const title=document.createElementNS('http://www.w3.org/2000/svg','title');
        title.textContent=`${acc.name} - ₹${acc.price_per_night}/night`;
        circle.appendChild(title);
        const animate=document.createElementNS('http://www.w3.org/2000/svg','animate');
        animate.setAttribute('attributeName','r');
        animate.setAttribute('values','6;8;6');
        animate.setAttribute('dur','2s');
        animate.setAttribute('repeatCount','indefinite');
        circle.appendChild(animate);
        markerGroup.appendChild(circle);
        markersGroup.appendChild(markerGroup);
      });
    }
    function openDistrictModal(districtId){
      const district=allDistricts.find(d=>d.id===districtId);
      if(!district)return;
      currentDistrict=district;
      const modalContent=`<img src="${district.image_url||'https://via.placeholder.com/900x350?text='+district.name}" alt="${district.name}" class="modal-image"><div class="modal-body"><h2>${district.name}</h2><p>${district.description||'Explore the rich heritage and attractions of '+district.name+'.'}</p><h3 style="margin-top:30px;margin-bottom:20px;font-size:24px;color:var(--state-primary)">Attractions in ${district.name}</h3>${district.attractions&&district.attractions.length>0?`<div class="attractions-grid-modal">${district.attractions.map(attraction=>`<div class="attraction-card-modal" onclick="openAttractionModal(${attraction.id})"><h4>${attraction.name}</h4><p>${attraction.short_description||'Click to view details'}</p></div>`).join('')}</div>`:'<div class="no-data">No attractions available for this district.</div>'}</div>`;
      document.getElementById('modalContentArea').innerHTML=modalContent;
      document.getElementById('districtModal').classList.add('active');
      document.getElementById('modalBack').classList.remove('visible');
      document.body.style.overflow='hidden';
    }
    function openAttractionModal(attractionId){
      if(!currentDistrict)return;
      const attraction=currentDistrict.attractions.find(a=>a.id===attractionId);
      if(!attraction)return;
      const modalContent=`<img src="${attraction.image_url||'https://via.placeholder.com/900x350?text='+attraction.name}" alt="${attraction.name}" class="modal-image"><div class="modal-body"><h2>${attraction.name}</h2><p>${attraction.description||attraction.short_description||'No description available.'}</p><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-top:30px;padding-top:30px;border-top:2px solid var(--state-accent)">${attraction.entry_fee!==undefined&&attraction.entry_fee!==null?`<div style="display:flex;align-items:center;gap:12px"><i class="fas fa-ticket-alt" style="color:var(--state-accent);font-size:20px"></i><div><strong style="display:block;color:var(--state-primary);font-size:14px;margin-bottom:4px">Entry Fee</strong><span style="color:var(--text-muted);font-size:15px">₹${attraction.entry_fee===0?'Free':attraction.entry_fee}</span></div></div>`:''} ${attraction.estimated_time_hours?`<div style="display:flex;align-items:center;gap:12px"><i class="fas fa-clock" style="color:var(--state-accent);font-size:20px"></i><div><strong style="display:block;color:var(--state-primary);font-size:14px;margin-bottom:4px">Time Needed</strong><span style="color:var(--text-muted);font-size:15px">${attraction.estimated_time_hours} hours</span></div></div>`:''} ${attraction.best_time_note?`<div style="display:flex;align-items:center;gap:12px"><i class="fas fa-calendar-alt" style="color:var(--state-accent);font-size:20px"></i><div><strong style="display:block;color:var(--state-primary);font-size:14px;margin-bottom:4px">Best Time</strong><span style="color:var(--text-muted);font-size:15px">${attraction.best_time_note}</span></div></div>`:''} ${attraction.address||attraction.city?`<div style="display:flex;align-items:center;gap:12px"><i class="fas fa-map-marker-alt" style="color:var(--state-accent);font-size:20px"></i><div><strong style="display:block;color:var(--state-primary);font-size:14px;margin-bottom:4px">Location</strong><span style="color:var(--text-muted);font-size:15px">${attraction.address||attraction.city||''}</span></div></div>`:''} ${attraction.contact_phone?`<div style="display:flex;align-items:center;gap:12px"><i class="fas fa-phone" style="color:var(--state-accent);font-size:20px"></i><div><strong style="display:block;color:var(--state-primary);font-size:14px;margin-bottom:4px">Contact</strong><span style="color:var(--text-muted);font-size:15px">${attraction.contact_phone}</span></div></div>`:''} ${attraction.guide_available?`<div style="display:flex;align-items:center;gap:12px"><i class="fas fa-user-tie" style="color:var(--state-accent);font-size:20px"></i><div><strong style="display:block;color:var(--state-primary);font-size:14px;margin-bottom:4px">Guide Available</strong><span style="color:var(--text-muted);font-size:15px">${attraction.guide_price_range||'Yes'}</span></div></div>`:''}</div>${attraction.accommodations&&attraction.accommodations.length>0?`<div class="accommodations-section"><h3>Nearby Accommodations</h3><ul class="accommodation-list">${attraction.accommodations.map(acc=>`<li class="accommodation-item"><h4>${acc.name}</h4><div class="acc-details"><span><i class="fas fa-tag"></i>${acc.type.charAt(0).toUpperCase()+acc.type.slice(1)}</span><span><i class="fas fa-rupee-sign"></i>₹${acc.price_per_night}/night</span>${acc.distance_from_attraction_km?`<span><i class="fas fa-map-marker-alt"></i>${acc.distance_from_attraction_km} km away</span>`:''}${acc.rating?`<span><i class="fas fa-star"></i>${acc.rating}/5</span>`:''}${acc.contact_phone?`<span><i class="fas fa-phone"></i>${acc.contact_phone}</span>`:''}</div></li>`).join('')}</ul></div>`:'<div class="accommodations-section"><h3>Nearby Accommodations</h3><div class="no-data">No accommodation information available for this attraction.</div></div>'}</div>`;
      document.getElementById('modalContentArea').innerHTML=modalContent;
      document.getElementById('modalBack').classList.add('visible');
    }
    function goBackToDistrict(){if(currentDistrict){openDistrictModal(currentDistrict.id)}}
    function closeDistrictModal(){document.getElementById('districtModal').classList.remove('active');document.body.style.overflow='auto';currentDistrict=null}
    document.getElementById('searchInput').addEventListener('input',filterDistricts);
    document.getElementById('sortSelect').addEventListener('change',(e)=>{sortDistricts(e.target.value)});
    document.getElementById('accommodationsToggle').addEventListener('click',()=>{const checkbox=document.getElementById('accommodationsCheckbox');checkbox.checked=!checkbox.checked;document.getElementById('accommodationsToggle').classList.toggle('active',checkbox.checked);filterDistricts()});
    document.getElementById('districtModal').addEventListener('click',(e)=>{if(e.target.id==='districtModal'){closeDistrictModal()}});
    window.addEventListener('load',()=>{loadDistricts()});
  </script>
</body>
</html>